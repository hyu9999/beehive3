from datetime import datetime

# 机器人基础信息，用于初始化测试数据库，不包含作者字段，创建需更新作者字段
from app.service.datetime import get_early_morning

base_robot = {
    "头像": "5dfc3cf1cae7032669c4d7f6",
    "简介": '<p><span style="color:#000000"><span style="font-size:16px"><strong>装备简介</strong></span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">综合考虑股票的基本面情况，在盈利能力、成长能力、偿债能力等多个方面进行整体打分，在上交所、深交所的主板市场中选出整体表现靠前，盈利能力突出的个股构成股票池。之后选择调整较为充分的个股进行买入，在持仓过程中利用股债平衡估值择时对整体仓位进行控制。 </span></span></p><p><span style="color:#000000"><span style="font-size:16px"><strong>装备特点</strong></span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">选取的个股有着优异的盈利能力和良好的基本面情况，在当前注重公司质地的市场环境中，更容易引资金的关注。总体来看组合的收益率和稳定性较好。</span></span></p><p><span style="background-color:#ffffff"><span style="color:#000000"><span style="font-size:16px"><strong>适合人群</strong></span></span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">适合稳健型，喜欢价值投资的客户。</span></span></p><p><span style="background-color:#ffffff"><span style="color:#000000"><span style="font-size:16px"><strong>各种市场环境下的使用方法</strong></span></span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">选股环节导致的买卖情况：选择股价与中期均线偏离度较大的个股买入，买入个股持有10天后会卖出。 </span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">择时环节导致的买卖情况：对市场进行股债平衡估值，当市场低估时逐渐增加组合的仓位，增加的仓位平均分配到持仓个股上。当市场高估时逐渐降低整体仓位，降低的仓位从持仓个股中平均减掉。</span></span></p>',
    "主页地址": None,
    "状态": "已上线",
    "创建时间": datetime.fromisoformat("2019-12-31T00:00:00"),
    "上线时间": datetime.fromisoformat("2019-12-31T00:00:00"),
    "下线时间": None,
    "回测开始时间": None,
    "回测结束时间": None,
    "标签": ["test_tag"],
    "可见模式": "完全公开",
    "评级": "C",
    "减仓模式": ["同比例减仓"],
    "卖出筛选器": ["超过最大持仓周期", "超过止损点", "超过止盈点", "风控信号"],
    "买入筛选器": ["买选股信号的股"],
    "保证持仓数量筛选器": ["ATR技术指标筛选"],
    "分析了多少支股票": 35,
    "管理了多少组合": 4,
    "累计管理资金": 2984772.21,
    "累计创造收益": -15227.79,
    "运行天数": 238,
    "累计产生信号数": 189,
    "累计服务人数": 105,
    "计算时间": datetime.fromisoformat("2020-08-25T00:00:00"),
    "订阅人数": 3,
    "累计收益率": 0.2215,
    "投资原则": [
        {"原则名称": "绩优股", "原则内容": "对全市场的股票根据盈利、成长、偿债、营运、现金流等多维度进行打分，选取出整体表现在市场排前20%的股票。"},
        {"原则名称": "有竞争优势", "原则内容": "再从中筛选出其中盈利能力（扣非ROE和营业利润率）突出的10%股票。"},
        {"原则名称": "超跌股", "原则内容": "股票当前股价偏离60日均线排序靠前。"},
        {"原则名称": "分散持股", "原则内容": "根据ATR技术指标筛选，使总持仓股 <= 5只。"},
        {"原则名称": "等仓位分配", "原则内容": "等仓位分配。"},
        {"原则名称": "固定周期调仓", "原则内容": "持有10天卖出。"},
    ],
    "原则配置": [
        {"唯一名称": "max_hold_day", "中文名称": "最大调仓周期", "配置规则": "默认值或用户自定义", "配置值": "10"},
        {"唯一名称": "max_hold_num", "中文名称": "最大持仓数量", "配置规则": "默认值或用户自定义", "配置值": "5"},
        {"唯一名称": "stopup", "中文名称": "止盈点", "配置规则": "默认值或用户自定义", "配置值": "1.0"},
        {"唯一名称": "stopdown", "中文名称": "止损点", "配置规则": "默认值或用户自定义", "配置值": "1.0"},
        {"唯一名称": "tax_rate", "中文名称": "交易费率", "配置规则": "默认值或用户自定义", "配置值": "0.0016"},
    ],
    "文章标识符": None,
    "风控包列表": [],
    "择时装备列表": [],
    "风控装备列表": [],
    "选股装备列表": [],
    "交易装备列表": [],
}
default_const_robot = {
    "标识符": "10100000test01",
    "名称": "test_robot",
    "择时装备列表": ["03000000test00"],
    "风控装备列表": ["04000000test00"],
    "选股装备列表": ["02000000test00"],
    "交易装备列表": ["01000000test00"],
}
default_const_robot.update(base_robot)
only_screen_const_robot = {
    "标识符": "15020000test01",
    "名称": "test_robot",
    "选股装备列表": ["02000000test00"],
}
only_screen_const_robot.update(base_robot)
# fake robot
const_robot = {"default": default_const_robot, "only_screen": only_screen_const_robot}


robot_test_data = {
    "标识符": "10000000test00",
    "名称": "test_robot",
    "头像": "5dfc3cf1cae7032669c4d7f6",
    "简介": '<p><span style="color:#000000"><span style="font-size:16px"><strong>装备简介</strong></span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">综合考虑股票的基本面情况，在盈利能力、成长能力、偿债能力等多个方面进行整体打分，在上交所、深交所的主板市场中选出整体表现靠前，盈利能力突出的个股构成股票池。之后选择调整较为充分的个股进行买入，在持仓过程中利用股债平衡估值择时对整体仓位进行控制。 </span></span></p><p><span style="color:#000000"><span style="font-size:16px"><strong>装备特点</strong></span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">选取的个股有着优异的盈利能力和良好的基本面情况，在当前注重公司质地的市场环境中，更容易引资金的关注。总体来看组合的收益率和稳定性较好。</span></span></p><p><span style="background-color:#ffffff"><span style="color:#000000"><span style="font-size:16px"><strong>适合人群</strong></span></span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">适合稳健型，喜欢价值投资的客户。</span></span></p><p><span style="background-color:#ffffff"><span style="color:#000000"><span style="font-size:16px"><strong>各种市场环境下的使用方法</strong></span></span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">选股环节导致的买卖情况：选择股价与中期均线偏离度较大的个股买入，买入个股持有10天后会卖出。 </span></span></p><p style="text-indent:2em;"><span style="color:#000000"><span style="font-size:16px">择时环节导致的买卖情况：对市场进行股债平衡估值，当市场低估时逐渐增加组合的仓位，增加的仓位平均分配到持仓个股上。当市场高估时逐渐降低整体仓位，降低的仓位从持仓个股中平均减掉。</span></span></p>',
    "主页地址": None,
    "状态": "已上线",
    "创建时间": datetime.fromisoformat("2019-12-31T00:00:00"),
    "上线时间": datetime.fromisoformat("2019-12-31T00:00:00"),
    "下线时间": None,
    "回测开始时间": None,
    "回测结束时间": None,
    "标签": ["test_tag"],
    "可见模式": "完全公开",
    "评级": "C",
    "风控包列表": [],
    "择时装备列表": ["03000000test00"],
    "风控装备列表": ["04000000test00"],
    "选股装备列表": ["02000000test00"],
    "交易装备列表": ["01000000test00"],
    "减仓模式": ["同比例减仓"],
    "卖出筛选器": ["超过最大持仓周期", "超过止损点", "超过止盈点", "风控信号"],
    "买入筛选器": ["买选股信号的股"],
    "保证持仓数量筛选器": ["ATR技术指标筛选"],
    "分析了多少支股票": 35,
    "管理了多少组合": 4,
    "累计管理资金": 2984772.21,
    "累计创造收益": -15227.79,
    "运行天数": 238,
    "累计产生信号数": 189,
    "累计服务人数": 105,
    "计算时间": datetime.fromisoformat("2020-08-25T00:00:00"),
    "订阅人数": 3,
    "累计收益率": 0.2215,
    "投资原则": [
        {"原则名称": "绩优股", "原则内容": "对全市场的股票根据盈利、成长、偿债、营运、现金流等多维度进行打分，选取出整体表现在市场排前20%的股票。"},
        {"原则名称": "有竞争优势", "原则内容": "再从中筛选出其中盈利能力（扣非ROE和营业利润率）突出的10%股票。"},
        {"原则名称": "超跌股", "原则内容": "股票当前股价偏离60日均线排序靠前。"},
        {"原则名称": "分散持股", "原则内容": "根据ATR技术指标筛选，使总持仓股 <= 5只。"},
        {"原则名称": "等仓位分配", "原则内容": "等仓位分配。"},
        {"原则名称": "固定周期调仓", "原则内容": "持有10天卖出。"},
    ],
    "原则配置": [
        {"唯一名称": "max_hold_day", "中文名称": "最大调仓周期", "配置规则": "默认值或用户自定义", "配置值": "10"},
        {"唯一名称": "max_hold_num", "中文名称": "最大持仓数量", "配置规则": "默认值或用户自定义", "配置值": "5"},
        {"唯一名称": "stopup", "中文名称": "止盈点", "配置规则": "默认值或用户自定义", "配置值": "1.0"},
        {"唯一名称": "stopdown", "中文名称": "止损点", "配置规则": "默认值或用户自定义", "配置值": "1.0"},
        {"唯一名称": "tax_rate", "中文名称": "交易费率", "配置规则": "默认值或用户自定义", "配置值": "0.0016"},
    ],
    "文章标识符": None,
}
robot_backtest_indicator_data = {
    "机器人回测指标数据": [
        {
            "交易日期": get_early_morning().isoformat(),
            "Alpha": 0.0308,
            "Beta": 0.0355,
            "上涨概率": 0.012,
            "交易天数": 141.0,
            "交易次数": 7.0,
            "信息比率": 0.7334,
            "入金": 0.0,
            "出金": 0.0,
            "基准年化收益率": -0.0381,
            "基准收益率": -0.0018,
            "基准波动率": 0.18,
            "夏普比率": 0.9241,
            "平均仓位": 0.0954,
            "平均涨幅": 0.0004,
            "年化收益率": 0.0632,
            "收益": -290.0,
            "收益波动率": 0.0633,
            "收益率": -0.0005,
            "最大单日涨幅": 0.03,
            "最大单日跌幅": -0.0149,
            "最大回撤": 0.0333,
            "最大连续上涨天数": 13.0,
            "最大连续下跌天数": 36.0,
            "盈亏比": 2.1525,
            "盈利天数": 17.0,
            "累计收益": 27242.424,
            "累计收益率": 0.0545,
            "股票仓位": 0.1988,
            "股票市值": 104835.0,
            "股票资产": 527242.424,
            "胜率": 0.5714,
            "资金余额": 422407.424,
            "资金周转率": 0.053,
            "近一周收益率": 0.0002,
            "近一月收益率": 0.0735,
            "超额收益率": 0.0012,
            "交易成本": 0.0,
            "平均交易成本": 0.0,
            "平均交易次数": 0.0496,
            "平均盈亏比": 0.3075,
            "平均胜率": 0.0816,
            "累计交易成本": 2239.576,
        }
    ]
}


robot_backtest_signal_data = {
    "机器人回测信号数据": [
        {
            "交易日期": get_early_morning().isoformat(),
            "证券代码": "002349",
            "交易市场": "CNSESZ",
            "收盘价": 13.05,
            "个股持仓市值": 138330.0,
            "个股持仓数量": 10600.0,
            "个股卖出均价": 0.0,
            "个股买入均价": 0.0,
            "个股持仓变动": 0.0,
            "个股收益率": 0.1550318789,
            "个股盈亏额": 18780.4864,
            "个股资金变动": 0.0,
            "个股持仓成本": 11.278256,
            "个股仓位占比": 0.2713,
            "行业分类": "中药Ⅱ",
            "证券名称": "精华制药",
            "买卖方向": "保持不变",
        }
    ]
}


robot_backtest_assess_data = {
    "机器人回测评级数据": [
        {
            "交易日期": get_early_morning().isoformat(),
            "年化收益率": 3.0,
            "年化收益率得分": 3.8571,
            "评级": "C",
            "最大回撤得分": 10.0,
            "最大回撤平均得分": 10.0,
            "年化收益率比最大回撤得分": 10.0,
            "总得分": 7.1213,
            "夏普比率得分": 5.0,
            "收益风险比得分": 8,
            "收益风险比平均得分": 5.1429,
            "数据集": "训练集评级",
            "开始时间": "2017-01-01T00:00:00.000+0000",
            "结束时间": "2018-01-01T00:00:00.000+0000",
        },
        {
            "交易日期": get_early_morning().isoformat(),
            "年化收益率": 3.0,
            "年化收益率得分": 3.8571,
            "评级": "D",
            "最大回撤得分": 10.0,
            "最大回撤平均得分": 10.0,
            "年化收益率比最大回撤得分": 10.0,
            "总得分": 5.4286,
            "夏普比率得分": 5.0,
            "收益风险比得分": 8,
            "收益风险比平均得分": 5.1429,
            "数据集": "测试集评级",
            "开始时间": "2018-01-01T00:00:00.000+0000",
            "结束时间": get_early_morning().isoformat(),
        },
        {
            "交易日期": get_early_morning().isoformat(),
            "年化收益率": 3.0,
            "年化收益率得分": 3.8571,
            "评级": "C",
            "最大回撤得分": 10.0,
            "最大回撤平均得分": 10.0,
            "年化收益率比最大回撤得分": 10.0,
            "总得分": 6.4286,
            "夏普比率得分": 5.0,
            "收益风险比得分": 8,
            "收益风险比平均得分": 5.1429,
            "数据集": "整体评级",
            "开始时间": "2017-01-01T00:00:00.000+0000",
            "结束时间": get_early_morning().isoformat(),
        },
    ]
}


robot_real_indicator_data = {
    "机器人实盘指标数据": [
        {
            "交易日期": get_early_morning().isoformat(),
            "Alpha": 0.0726,
            "Beta": 0.3723,
            "上涨概率": 0.3041,
            "交易天数": 156.0,
            "交易成本": 0.0,
            "交易次数": 64.0,
            "信息比率": -0.6485,
            "入金": 0.0,
            "出金": 0.0,
            "基准年化收益率": 0.2987,
            "基准收益率": -0.0006,
            "基准波动率": 0.2644,
            "夏普比率": 1.6386,
            "平均仓位": 0.4791,
            "平均涨幅": 0.0012,
            "年化收益率": 0.2058,
            "收益": -1176.0,
            "收益波动率": 0.1587,
            "收益率": -0.002,
            "最大单日涨幅": 0.0392,
            "最大单日跌幅": -0.0383,
            "最大回撤": 0.0776,
            "最大连续上涨天数": 6.0,
            "最大连续下跌天数": 21.0,
            "盈亏比": 2.011,
            "盈利天数": 66.0,
            "累计交易成本": 17796.0413,
            "累计收益": 99204.0238,
            "累计收益率": 0.1984,
            "股票仓位": 0.3941,
            "股票市值": 236133.0,
            "股票资产": 599204.0238,
            "胜率": 0.5625,
            "资金余额": 363071.0238,
            "资金周转率": 0.1805,
            "超额收益率": -0.0013,
            "近一周收益率": 0.0126,
            "近一月收益率": -0.001,
            "平均交易成本": 0.0,
            "平均交易次数": 0.4103,
            "平均盈亏比": 0.0314,
            "平均胜率": 0.0088,
        }
    ]
}


robot_real_signal_data = {
    "机器人实盘信号数据": [
        {
            "交易日期": get_early_morning().isoformat(),
            "证券代码": "600507",
            "个股买入均价": 0.0,
            "个股交易成本": 0.0,
            "个股仓位占比": 0.1809,
            "个股卖出均价": 0.0,
            "个股持仓变动": 0.0,
            "个股持仓天数": 14.0,
            "个股持仓市值": 31768.0,
            "个股持仓成本": 12.903887999999998,
            "个股持仓数量": 2200.0,
            "个股收益率": 0.08189635484654212,
            "个股盈亏额": 3379.4464000000044,
            "个股累计交易成本": 86.5536,
            "个股资金变动": 0.0,
            "交易市场": "CNSESH",
            "收盘价": 14.44,
            "行业分类": "钢铁Ⅱ",
            "证券名称": "方大特钢",
            "买卖方向": "保持不变",
        }
    ]
}
